<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>~/ â€¢ Wire GUARD(?) simple setup cheat sheet</title><link href=https://gatunet.github.io/tabibito/atom.xml rel=alternate title=~/ type=application/atom+xml><link href=https://gatunet.github.io/tabibito/custom_subset.css rel=stylesheet><link href=https://gatunet.github.io/tabibito/main.css media=screen rel=stylesheet><meta content="tabi is a simple personal site and blogging theme for Zola." name=description><meta content="index, nofollow" name=robots><meta content=~/ property=og:title><meta content=article property=og:type><meta content=https://gatunet.github.io/tabibito/blog/wireguard-setup/ property=og:url><meta content="tabi is a simple personal site and blogging theme for Zola." property=og:description><meta content=~/ property=og:site_name><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;script-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com" http-equiv=Content-Security-Policy><script src=https://gatunet.github.io/tabibito/js/initialize_theme_min.js></script><script defer src=https://gatunet.github.io/tabibito/js/main_min.js></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://gatunet.github.io/tabibito>~/</a></div><div class="nav-navs socials"><ul><li><a class="nav-links no-hover-padding social" rel="noopener noreferrer" href=https://github.com/gatunet/ target=_blank> <img alt=github src=https://gatunet.github.io/tabibito/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel="noopener noreferrer" href=https://hachyderm.io/@gartunius target=_blank> <img alt=mastodon src=https://gatunet.github.io/tabibito/social_icons/mastodon.svg title=mastodon> </a></ul></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://gatunet.github.io/tabibito/blog>blog</a><li><a class="nav-links no-hover-padding" href=https://gatunet.github.io/tabibito/archive>archive</a><li><a class="nav-links no-hover-padding" href=https://gatunet.github.io/tabibito/projects>projects</a><li class=theme-switcher-wrapper><div class=theme-switcher></div></ul></div></nav></header><div class=content><main><article><div class=article-title>Wire GUARD(?) simple setup cheat sheet</div><ul class=meta><li>11th Jun 2023 â€¢<li title="431 words">Â 3 min read</ul><section class=body><p>Just a simple cheat sheet for a quick wireguard setup.<h3 id=generating-keys><a aria-label="Anchor link for: generating-keys" class=zola-anchor href=#generating-keys>ðŸ”—</a>Generating Keys</h3><p>You need to generate a key pair for both nodes (server and client).<h4 id=private-key><a aria-label="Anchor link for: private-key" class=zola-anchor href=#private-key>ðŸ”—</a>Private Key:</h4><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wg</span></span><span class="z-meta z-function-call z-arguments z-shell"> genkey</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> tee /etc/wireguard/private.key <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"># Can be changed to whathever directory you want</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> go= /etc/wireguard/private.key <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"># Should match the previous directory</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre><h4 id=public-key><a aria-label="Anchor link for: public-key" class=zola-anchor href=#public-key>ðŸ”—</a>Public Key:</h4><p>This one you can derive from the private, so I wont store it in a file, but you can if you want<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cat</span></span><span class="z-meta z-function-call z-arguments z-shell"> /etc/wireguard/private.key</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wg</span></span><span class="z-meta z-function-call z-arguments z-shell"> pubkey</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> tee</span>
</span></code></pre><h3 id=node-settings-file><a aria-label="Anchor link for: node-settings-file" class=zola-anchor href=#node-settings-file>ðŸ”—</a>Node settings file</h3><p>Then you need to make a file for the connection on the node(server), usually it stays on <code>/etc/wireguard/wg0.conf</code> and it's like this:<pre class="language-ini z-code" data-lang=ini><code class=language-ini data-lang=ini><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Interface]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">PrivateKey</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-keyword z-operator z-genconfig">*</span>server private key<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Address</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">10.8.0.1/24</span></span> <span class="z-keyword z-operator z-genconfig">*</span>here you can pick any private <span class="z-support z-constant z-genconfig">IP</span> range<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ListenPort</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-constant z-numeric z-genconfig">51820</span> <span class="z-keyword z-operator z-genconfig">*</span>your port<span class="z-keyword z-operator z-genconfig">,</span> this is the default<span class="z-keyword z-operator z-genconfig">,</span> but you can change it to whathever you want<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">PostUp</span> <span class="z-keyword z-operator z-genconfig">=</span></span>  iptables <span class="z-keyword z-operator z-genconfig">-</span>t nat <span class="z-keyword z-operator z-genconfig">-</span><span class="z-support z-constant z-genconfig">A</span> <span class="z-support z-constant z-genconfig">POSTROUTING</span> <span class="z-keyword z-operator z-genconfig">-</span>s <span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">10.8.0.0/24</span></span> <span class="z-keyword z-operator z-genconfig">-</span>o eth0 <span class="z-keyword z-operator z-genconfig">-</span>j <span class="z-support z-constant z-genconfig">MASQUERADE</span>; iptables <span class="z-keyword z-operator z-genconfig">-</span><span class="z-support z-constant z-genconfig">A</span> <span class="z-support z-constant z-genconfig">INPUT</span> <span class="z-keyword z-operator z-genconfig">-</span>p udp <span class="z-keyword z-operator z-genconfig">-</span>m udp <span class="z-keyword z-operator z-genconfig">-</span><span class="z-keyword z-operator z-genconfig">-</span>dport <span class="z-constant z-numeric z-genconfig">51820</span> <span class="z-keyword z-operator z-genconfig">-</span>j <span class="z-support z-constant z-genconfig">ACCEPT</span>; iptables <span class="z-keyword z-operator z-genconfig">-</span><span class="z-support z-constant z-genconfig">A</span> <span class="z-support z-constant z-genconfig">FORWARD</span> <span class="z-keyword z-operator z-genconfig">-</span>i wg0 <span class="z-keyword z-operator z-genconfig">-</span>j <span class="z-support z-constant z-genconfig">ACCEPT</span>; iptables <span class="z-keyword z-operator z-genconfig">-</span><span class="z-support z-constant z-genconfig">A</span> <span class="z-support z-constant z-genconfig">FORWARD</span> <span class="z-keyword z-operator z-genconfig">-</span>o wg0 <span class="z-keyword z-operator z-genconfig">-</span>j <span class="z-support z-constant z-genconfig">ACCEPT</span>;
<span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># This PostUp line is (as I understand, and I don't know a lot about iptables) so you can route the traffic that comes from the clients, so they can access the internet through the server (like a "normal"/comercial vpn)
</span></span>
<span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Also, if you're going to use it, remember to change the network interface and the ip range if needed
</span></span>
<span class="z-storage z-type z-genconfig">[Peer]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">PublicKey</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-keyword z-operator z-genconfig">*</span>client public key<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">AllowedIPs</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">10.8.0.3/32</span></span> <span class="z-keyword z-operator z-genconfig">*</span>clients ip<span class="z-keyword z-operator z-genconfig">*</span>
</span></code></pre><p>Then you need another config file for the node(client):<pre class="language-ini z-code" data-lang=ini><code class=language-ini data-lang=ini><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Interface]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">PrivateKey</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-keyword z-operator z-genconfig">*</span>client private key<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Address</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">10.8.0.3/32</span></span> <span class="z-keyword z-operator z-genconfig">*</span>client ip<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-support z-constant z-genconfig">DNS</span> <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">9.9.9.9</span></span> <span class="z-keyword z-operator z-genconfig">*</span><span class="z-support z-constant z-genconfig">DNS</span> Server<span class="z-keyword z-operator z-genconfig">,</span> <span class="z-support z-constant z-genconfig">I</span> usually go <span class="z-keyword z-other z-genconfig">with</span> Quad9<span class="z-keyword z-operator z-genconfig">,</span> but again you can pick whathever<span class="z-keyword z-operator z-genconfig">*</span>

<span class="z-storage z-type z-genconfig">[Peer]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">PublicKey</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-keyword z-operator z-genconfig">*</span>server public key<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">AllowedIPs</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">0.0.0.0/0</span></span><span class="z-keyword z-operator z-genconfig">,</span> <span class="z-keyword z-operator z-genconfig">:</span><span class="z-keyword z-operator z-genconfig">:</span><span class="z-keyword z-operator z-genconfig">/</span><span class="z-constant z-numeric z-genconfig">0</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Endpoint</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-keyword z-operator z-genconfig">*</span>server ip and port<span class="z-keyword z-operator z-genconfig">,</span> like this<span class="z-keyword z-operator z-genconfig">:</span> ip<span class="z-keyword z-operator z-genconfig">:</span>port<span class="z-keyword z-operator z-genconfig">*</span>
<span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">PersistentKeepalive</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-constant z-numeric z-genconfig">0</span> <span class="z-keyword z-operator z-genconfig">*</span><span class="z-keyword z-other z-genconfig">if</span> you want the connection to always stay up<span class="z-keyword z-operator z-genconfig">*</span>
</span></code></pre><p>PS: Here we're separating client and server, but to wireguard there's only nodes, the difference, is that certain nodes(like our server node) can relay traffic.<h3 id=starting-up-the-connection><a aria-label="Anchor link for: starting-up-the-connection" class=zola-anchor href=#starting-up-the-connection>ðŸ”—</a>Starting up the connection</h3><h4 id=server><a aria-label="Anchor link for: server" class=zola-anchor href=#server>ðŸ”—</a>Server</h4><p>On the server(node), you can use a wireguard tool:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wg-quick</span></span><span class="z-meta z-function-call z-arguments z-shell"> up wg0 <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"># or whathever the name for your config is</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre><h4 id=client><a aria-label="Anchor link for: client" class=zola-anchor href=#client>ðŸ”—</a>Client</h4><p>On the client(node) there's a <a href=https://www.wireguard.com/install/ rel=noopener target=_blank>bunch of GUIs</a> you can use, but if you want you can just use the CLI.<p>When I find time, I'll figure it out how to add images here properly (ï¿£â–½ï¿£*)ã‚ž<h3 id=references><a aria-label="Anchor link for: references" class=zola-anchor href=#references>ðŸ”—</a>References</h3><ul><li><a href=https://github.com/pirate/wireguard-docs rel=noopener target=_blank>Github - pirate/wireguard-docs</a><li><a href=https://www.wireguard.com/quickstart/ rel=noopener target=_blank>Wireguard - Quick Start</a></ul></section></article></main></div><footer><section><div class=credits><small>Powered by <a href=https://www.getzola.org target=_blank>Zola</a> & <a href=https://github.com/welpo/tabi target=_blank>tabi</a></small></div></section></footer>